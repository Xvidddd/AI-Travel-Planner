# 测试与交付策略

## 1. 测试范围
- **功能测试**：行程生成、编辑、保存、版本回滚、预算计算、语音记账、地图联动。
- **接口测试**：LLM、讯飞、高德、Supabase REST/Edge Functions。
- **性能测试**：首屏加载、LLM 延迟、地图渲染帧率、费用计算 Edge Function 延迟。
- **安全测试**：RLS 策略、未授权访问、环境变量泄漏、XSS/CSRF。
- **兼容性测试**：Chrome、Edge、Safari、Android Chrome、iOS Safari。

## 2. 测试方法
| 类型 | 工具 | 说明 |
| --- | --- | --- |
| 单元测试 | Vitest + React Testing Library | 组件、hooks、数据转换逻辑 |
| 集成测试 | Playwright | 语音模拟（使用预录音频）、行程创建流程 |
| 合约测试 | Pact | LLM 接口与后端解析的 schema 校验 |
| 负载测试 | k6 | Edge Functions 与 Next.js API 路径 |
| 可观测性 | OpenTelemetry + Supabase logs | 追踪请求链路与 LLM 时延 |

## 3. 测试里程碑
1. **M1**：完成基础组件与 API mock 的单元测试（覆盖率 60%）。
2. **M2**：AI 行程 + 地图联动 E2E 测试脚本跑通。
3. **M3**：预算/记账 Edge Function 负载测试，确保 95% 请求 < 500ms。
4. **M4**：全平台兼容性测试 + 无障碍检查 (axe)。
5. **M5**：回归测试 + 发布前验收（含真人语音测试）。

## 4. 缺陷管理
- 使用 Linear 提交 bug，优先级分 P0-P3。
- P0/P1 缺陷须在 24h 内修复并回归。
- 引入 `bugfix/*` Git 分支策略，合并前必须通过自动化测试。

## 5. 交付物清单
1. **源代码仓库**：GitHub 公网/私有，含 README、运行指南、架构文档链接。
2. **Docker 镜像**：通过 GitHub Actions 打包并推送至阿里云 ACR，同时导出 `ai-travel-planner.tar`。
3. **.env.example**：列出所有必需变量及说明。
4. **PDF 文件**：包含仓库地址、部署步骤、API Key 说明、文档索引。
5. **快速运行脚本**：`scripts/setup.sh`、`scripts/dev.sh`（后续迭代）。
6. **演示素材**：可选提供短视频或 GIF。

## 6. 验收流程
- 测试负责人出具《测试总结报告》并列出遗留问题。
- 产品负责人根据需求规格逐条验收。
- 助教可使用 README + PDF + Docker 镜像完成复现；若使用非阿里云 Key，则在 README 中附测试 Key。

## 7. 维护计划
- 正式发布后 3 个月内保留服务器/API Key 有效性。
- 每周巡检日志，关注 LLM 费用与错误率。
- 若第三方 API 变动，需在 48h 内更新配置文档。
